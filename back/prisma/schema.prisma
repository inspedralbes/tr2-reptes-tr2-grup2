// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

// Every String @db.Text excepting the commented ones, is due to is actually JSONs or ARRAYs 
generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "mysql"
}

model Tallers {
  //Fields
  id          Int       @id @default(autoincrement())
  nom         String
  descripcio  String    @db.Text // Actual Text
  institucio  Int
  tallerista  String //quien lo hace 
  places_max  Int
  places_disp Int
  modalitat   Modalitat // C
  direccio    String
  horari      String    @db.Text
  periode     Int
  autoritzat  Boolean   @default(false)
  imatge      String?

  admin Int

  admet_insc Boolean?

  // Intern relations
  id_institucio Institucions @relation(fields: [institucio], references: [id])
  id_admin      Usuaris      @relation(fields: [admin], references: [id])
  id_periode    Periodes     @relation(fields: [periode], references: [id])

  //Foreigns
  llista_assistencia Assistencia[]
  inscripcions       Inscripcions[]
}

model Institucions {
  id          Int    @id @default(autoincrement())
  nom         String
  codi_centre String
  direccio    String
  codi_postal String

  tallers      Tallers[]
  institucions Inscripcions[]
  historic     Historic[]

  // Relación inversa para ver responsables
  usuaris Usuaris[]
}

model Inscripcions {
  // Fields
  id                Int      @id @default(autoincrement())
  institucio        Int // una institució nomes pot tenir una inscripció per periode
  primera_vegada    Boolean
  periode           Int
  alumnes           String   @db.Text
  referents         String?  @db.Text
  docents_referents String? //@type Email ?
  comentari         String?  @db.Text
  documents         String?  @db.Text
  autoritzat        Boolean  @default(false)
  estat             Boolean?
  puntuacio         Float?
  NE               Boolean  @default(false)

  // relación opcional al taller (campo mapeado a columna `taller_id`)
  tallerId Int?    @map("taller_id")
  taller   Tallers? @relation(fields: [tallerId], references: [id])

  // Intern relations
  id_institucio   Institucions @relation(fields: [institucio], references: [id])
  periode_relacio Periodes     @relation(fields: [periode], references: [id])
}

model Usuaris {
  id         Int     @id @default(autoincrement())
  nom        String
  email      String  @unique
  password   String
  telefon    Int
  token      String?
  rol        Rol
  institucio Int?
  autoritzat Boolean
  responsable Boolean @default(false)

  // Relación a institución
  id_institucio Institucions? @relation(fields: [institucio], references: [id])

  tallers Tallers[]
}

model Assistencia {
  id                Int      @id @default(autoincrement())
  id_taller         Int
  dia               DateTime
  llista_alumnes    String   @db.Text
  llista_professors String   @db.Text
  autoritzat        Boolean

  // Intern relations
  taller Tallers @relation(fields: [id_taller], references: [id])
}

model Periodes {
  id      Int      @id @default(autoincrement())
  dataIni DateTime
  dataFi  DateTime

  // Foreigns
  historic     Historic[]
  tallers      Tallers[]
  inscripcions Inscripcions[]
}

model Historic {
  id            Int   @id @default(autoincrement())
  id_institucio Int
  periode       Int
  assistencia   Float

  // Relations
  id_institucio_rel Institucions @relation(fields: [id_institucio], references: [id])
  periode_rel       Periodes     @relation(fields: [periode], references: [id])
}

enum Rol {
  Admin
  Professorat
}

enum Institucio {
  CentreEducatiu
  Consorci
}

enum Modalitat {
  A
  B
  C
}